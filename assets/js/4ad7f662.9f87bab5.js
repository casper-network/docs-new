"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[5311],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var i=a.createContext({}),c=function(e){var t=a.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(i.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,i=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=c(n),d=r,m=h["".concat(i,".").concat(d)]||h[d]||p[d]||o;return n?a.createElement(m,s(s({ref:t},u),{},{components:n})):a.createElement(m,s({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,s=new Array(o);s[0]=h;var l={};for(var i in t)hasOwnProperty.call(t,i)&&(l[i]=t[i]);l.originalType=e,l.mdxType="string"==typeof e?e:r,s[1]=l;for(var c=2;c<o;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},6097:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return i},default:function(){return d},frontMatter:function(){return l},metadata:function(){return c},toc:function(){return p}});var a=n(3117),r=n(102),o=(n(7294),n(3905)),s=["components"],l={},i="Tutorial Walkthrough",c={unversionedId:"dapp-dev-guide/tutorials/counter-testnet/walkthrough",id:"dapp-dev-guide/tutorials/counter-testnet/walkthrough",title:"Tutorial Walkthrough",description:"Now that we are familiar with the basic commands, we can begin the tutorial to deploy a contract application and use it on the network.",source:"@site/source/docs/casper/dapp-dev-guide/tutorials/counter-testnet/walkthrough.md",sourceDirName:"dapp-dev-guide/tutorials/counter-testnet",slug:"/dapp-dev-guide/tutorials/counter-testnet/walkthrough",permalink:"/dapp-dev-guide/tutorials/counter-testnet/walkthrough",editUrl:"https://github.com/casper-network/docs/tree/main/source/docs/casper/dapp-dev-guide/tutorials/counter-testnet/walkthrough.md",tags:[],version:"current",lastUpdatedAt:1674584353,formattedLastUpdatedAt:"1/24/2023",frontMatter:{},sidebar:"dapp-dev-guide",previous:{title:"Important Commands",permalink:"/dapp-dev-guide/tutorials/counter-testnet/commands"},next:{title:"Interacting with Runtime Return Values",permalink:"/dapp-dev-guide/tutorials/return-values-tutorial"}},u={},p=[{value:"Clone the Contracts",id:"clone-the-contracts",level:2},{value:"View the Network State",id:"view-the-network-state",level:2},{value:"Deploy the Counter",id:"deploy-the-counter",level:2},{value:"View the Updated Network State",id:"view-the-updated-network-state",level:2},{value:"Increment the Counter",id:"increment-the-counter",level:2},{value:"View the Updated Network State Again",id:"view-the-updated-network-state-again",level:2},{value:"Increment the Counter Again",id:"increment-the-counter-again",level:2},{value:"View the Final Network State",id:"view-the-final-network-state",level:2}],h={toc:p};function d(e){var t=e.components,n=(0,r.Z)(e,s);return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"tutorial-walkthrough"},"Tutorial Walkthrough"),(0,o.kt)("p",null,"Now that we are familiar with the basic commands, we can begin the tutorial to deploy a contract application and use it on the network."),(0,o.kt)("h2",{id:"clone-the-contracts"},"Clone the Contracts"),(0,o.kt)("p",null,"First, we will need to clone ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/casper-ecosystem/counter"},"the counter contract repository")," to our local machine."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"git clone https://github.com/casper-ecosystem/counter\n")),(0,o.kt)("p",null,"If you explore the source code, you will see that there are two smart contracts:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"counter-define")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Defines two named keys: ",(0,o.kt)("em",{parentName:"li"},"counter")," to reference the contract and an associated variable ",(0,o.kt)("em",{parentName:"li"},"count")," to store the number of times we increment the counter"),(0,o.kt)("li",{parentName:"ul"},"Provides a function to get the current count (",(0,o.kt)("em",{parentName:"li"},"count_get"),")"),(0,o.kt)("li",{parentName:"ul"},"Provides a function to increment the current count (",(0,o.kt)("em",{parentName:"li"},"counter_inc"),")"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"counter-call")),(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Retrieves the ",(0,o.kt)("em",{parentName:"li"},"counter-define")," contract, gets the current count value, increments it, and makes sure count was incremented by 1")))),(0,o.kt)("h2",{id:"view-the-network-state"},"View the Network State"),(0,o.kt)("p",null,"With a network up and running, you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"casper-client query-global-state")," command to check the status of the network. However, we first need an ",(0,o.kt)("inlineCode",{parentName:"p"},"account hash")," and the ",(0,o.kt)("inlineCode",{parentName:"p"},"state-root-hash")," so that we can get the current snapshot. Once we have that information, we can check the status of the network."),(0,o.kt)("p",null,"As a summary, we need to use the following three commands:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Get the account-hash: ",(0,o.kt)("inlineCode",{parentName:"li"},"casper-client account-address --public-key [PATH_TO_PUBLIC_KEY]")),(0,o.kt)("li",{parentName:"ol"},"Get the state-root-hash: ",(0,o.kt)("inlineCode",{parentName:"li"},"casper-client get-state-root-hash")),(0,o.kt)("li",{parentName:"ol"},"Query the network state: ",(0,o.kt)("inlineCode",{parentName:"li"},"casper-client query-state"))),(0,o.kt)("p",null,"Let's execute the commands in order. First, we need the account-hash:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client account-address --public-key [PATH_TO_PUBLIC_KEY]\n")),(0,o.kt)("p",null,"You will need to specify the location of your public-key files. If you used the block explorer to generate the keys, you will need to download them first."),(0,o.kt)("p",null,"Next, get the state-root-hash:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address http://[NODE_IP]:7777\n")),(0,o.kt)("p",null,"We need to use the IP address of one of the ",(0,o.kt)("a",{parentName:"p",href:"https://testnet.cspr.live/tools/peers"},"connected peers")," on the Testnet as the node server since the network is running in a decentralized fashion. Make a note of the returned state-root-hash, but keep in mind that this hash value will need to be updated every time we modify the network state."),(0,o.kt)("p",null,"Finally, query the actual state:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client query-global-state \\\n    --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH] \\\n    --key [ACCOUNT_HASH]\n")),(0,o.kt)("p",null,"Substitute the state root hash and account hash values you just retrieved into this command and execute it. Do not be surprised if you see nothing on the network. That is because we have not sent anything to the network yet!"),(0,o.kt)("h2",{id:"deploy-the-counter"},"Deploy the Counter"),(0,o.kt)("p",null,"Let us try installing the ",(0,o.kt)("em",{parentName:"p"},"counter-define")," contract to the chain. First, we need to compile it."),(0,o.kt)("p",null,"The makefile included in the repository makes compilation trivial. With these two commands, we can build (in release mode) and test the contract before installing it. ",(0,o.kt)("em",{parentName:"p"},"make prepare")," sets the Wasm target and ",(0,o.kt)("em",{parentName:"p"},"make test")," builds the contracts and verifies them."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"cd counter\nmake prepare\nmake test\n")),(0,o.kt)("p",null,"With the compiled contract, we can call the ",(0,o.kt)("inlineCode",{parentName:"p"},"casper-client put-deploy")," command to install the contract on the chain."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n    --node-address http://[NODE_IP]:7777 \\\n    --chain-name casper-test \\\n    --secret-key [PATH_TO_YOUR_KEY]/secret_key.pem \\\n    --payment-amount 5000000000000 \\\n    --session-path ./counter/target/wasm32-unknown-unknown/release/counter-define.wasm\n")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Replace the ",(0,o.kt)("inlineCode",{parentName:"li"},"[PATH_TO_YOUR_KEY]")," field with the actual path of where your secret key is stored."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("em",{parentName:"li"},"session-path")," argument should point to wherever you compiled counter-define.wasm on your computer. The code snippet shows you the default path if the counter folder is in the same directory.")),(0,o.kt)("p",null,"Once you call this command, it will return a deploy hash. You can use this hash to verify that the deploy successfully took place."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rust"},"casper-client get-deploy \\\n    --node-address http://[NODE_IP]:7777 [DEPLOY_HASH]\n")),(0,o.kt)("h2",{id:"view-the-updated-network-state"},"View the Updated Network State"),(0,o.kt)("p",null,"Hopefully, the deploy was successful. Let us call the ",(0,o.kt)("inlineCode",{parentName:"p"},"casper-client query-global-state")," command to check if the named key is visible on the chain now."),(0,o.kt)("div",{className:"admonition admonition-note alert alert--secondary"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"}))),"note")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},"We must get the new state root hash since we just wrote a deploy to the chain."))),(0,o.kt)("p",null,"If you run these two commands, there will be a new counter named key on the chain."),(0,o.kt)("p",null,"Get the NEW state-root-hash:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address http://[NODE_IP]:7777\n")),(0,o.kt)("p",null,"Get the network state:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client query-global-state \\\n    --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH] \\\n    --key [ACCOUNT_HASH]\n")),(0,o.kt)("p",null,"We can actually dive further into the data stored on the chain using the query path argument or directly querying the deploy hash. Try the following commands and notice that each one gives you a different level of detail."),(0,o.kt)("p",null,"Retrieve the specific counter contract details:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client query-global-state --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH] \\\n    --key [ACCOUNT_HASH] -q "counter"\n')),(0,o.kt)("p",null,"Retrieve the specific counter variable details:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client query-global-state --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH] \\\n    --key [ACCOUNT_HASH] -q "counter/count"\n')),(0,o.kt)("p",null,"Retrieve the specific deploy details:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client query-global-state --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH] --key deploy-[DEPLOY_HASH]\n")),(0,o.kt)("p",null,"The first two commands access the counter and count named keys, respectively, using the query path argument. The third command uses the deploy hash (the return value of ",(0,o.kt)("em",{parentName:"p"},"put-deploy"),") to query the state of that specific deploy only."),(0,o.kt)("h2",{id:"increment-the-counter"},"Increment the Counter"),(0,o.kt)("p",null,"We now have a counter on the chain, and we verified everything is good. Now we want to increment it. We can do that by calling the entry-point ",(0,o.kt)("em",{parentName:"p"},"counter_inc"),", the function we defined in the ",(0,o.kt)("em",{parentName:"p"},"counter-define")," contract. You can call an entry-point in an installed contract by using the ",(0,o.kt)("em",{parentName:"p"},"put-deploy")," command as illustrated here:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client put-deploy \\\n    --node-address http://[NODE_IP]:7777 \\\n    --chain-name casper-test \\\n    --secret-key [PATH_TO_YOUR_KEY]/secret_key.pem \\\n    --payment-amount 5000000000000 \\\n    --session-name "counter" \\\n    --session-entry-point "counter_inc"\n')),(0,o.kt)("p",null,"Notice that this command is nearly identical to the command used to deploy the contract. However, instead of ",(0,o.kt)("em",{parentName:"p"},"session-path")," pointing to the Wasm binary, we have ",(0,o.kt)("em",{parentName:"p"},"session-name")," and ",(0,o.kt)("em",{parentName:"p"},"session-entry-point")," identifying the on-chain contract and its associated function to execute. There is no Wasm file needed since the contract is already on the blockchain."),(0,o.kt)("h2",{id:"view-the-updated-network-state-again"},"View the Updated Network State Again"),(0,o.kt)("p",null,"After calling the entry-point, theoretically, the counter value should increment by one, but how can we be sure of that? We can query the network again, however, remember that we have to get a new state root hash. Let us check if the counter was incremented by looking at the count with the query argument."),(0,o.kt)("p",null,"Get the NEW state-root-hash:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address http://[NODE_IP]:7777\n")),(0,o.kt)("p",null,"Get the network state, specifically for the count variable this time:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client query-global-state --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH] \\\n    --key [ACCOUNT_HASH] -q "counter/count"\n')),(0,o.kt)("p",null,"You should be able to see the counter variable and observe its value has increased now."),(0,o.kt)("h2",{id:"increment-the-counter-again"},"Increment the Counter Again"),(0,o.kt)("p",null,"If you recall, we had a second contract named ",(0,o.kt)("em",{parentName:"p"},"counter-call")," in the repository. This time around, we can see if we can increment the count using that second contract instead of the session entry-point we used above."),(0,o.kt)("p",null,"Keep in mind, this is another ",(0,o.kt)("em",{parentName:"p"},"put-deploy")," call just like when we sent the ",(0,o.kt)("em",{parentName:"p"},"counter_define")," contract to the blockchain. The session-path is once again going to be different for you depending on where you compiled the contract."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client put-deploy \\\n    --node-address http://[NODE_IP]:7777 \\\n    --chain-name casper-test \\\n    --secret-key [PATH_TO_YOUR_KEY]/secret_key.pem \\\n    --payment-amount 5000000000000 \\\n    --session-path ./counter/target/wasm32-unknown-unknown/release/counter-call.wasm\n")),(0,o.kt)("h2",{id:"view-the-final-network-state"},"View the Final Network State"),(0,o.kt)("p",null,"Before we wrap up this guide, let us make sure that the second contract did update the counter from the first contract. Just as before, we need a new state-root-hash, and then we can query the network."),(0,o.kt)("p",null,"Get the NEW state-root-hash:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"casper-client get-state-root-hash --node-address http://[NODE_IP]:7777\n")),(0,o.kt)("p",null,"Get the network state, specifically for the count variable this time:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'casper-client query-global-state --node-address http://[NODE_IP]:7777 \\\n    --state-root-hash [STATE_ROOT_HASH]\n    --key [ACCOUNT_HASH] -q "counter/count"\n')),(0,o.kt)("p",null,"If all went according to plan, your counter should have gone from 0 to 1 before and now from 1 to 2 as you incremented it throughout this tutorial. Congratulations on building, installing, and using a smart contract on your local test network! Now you are ready to build your own dApps and launch them onto the Casper blockchain."))}d.isMDXComponent=!0}}]);